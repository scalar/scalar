# Generate OpenAPI Documents at Build Time

This guide shows you how to generate OpenAPI documents during the build process for your ASP.NET Core application. Build-time generation is useful for:

- Creating OpenAPI documents that are committed to source control
- Publishing OpenAPI documents to the [Scalar Registry](/guides/registry/upload)

## Microsoft.AspNetCore.OpenApi

The `Microsoft.AspNetCore.OpenApi` package provides built-in support for generating OpenAPI documents at build time.

For complete details, see the [Microsoft documentation](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/openapi/aspnetcore-openapi?view=aspnetcore-9.0&tabs=visual-studio%2Cvisual-studio-code#generate-openapi-documents-at-build-time).

### Installation

Install the required package:

```shell
dotnet add package Microsoft.Extensions.ApiDescription.Server
```

### Enable Build-Time Generation

The `Microsoft.Extensions.ApiDescription.Server` pa1ckage automatically generates OpenAPI documents during build. By default, the OpenAPI document will be generated in your project's output directory as `{ProjectName}.json`.

### Customization Options

#### Change Output File Name

To generate the file as `openapi.json`, customize the generated file name:

```xml
<PropertyGroup>
  <OpenApiGenerateDocumentsOptions>--file-name openapi</OpenApiGenerateDocumentsOptions>
</PropertyGroup>
```

#### Change Output Directory

Modify where the OpenAPI file is generated by setting the `OpenApiDocumentsDirectory` property:

```xml
<PropertyGroup>
  <!-- Generate in project root directory instead of output directory -->
  <OpenApiDocumentsDirectory>.</OpenApiDocumentsDirectory>
</PropertyGroup>
```

#### Generate Specific Document

If you have multiple OpenAPI documents configured, generate only a specific one:

```xml
<PropertyGroup>
  <OpenApiGenerateDocumentsOptions>--document-name v2</OpenApiGenerateDocumentsOptions>
</PropertyGroup>
```

## Swashbuckle.AspNetCore.SwaggerGen

Swashbuckle supports build-time OpenAPI generation using the Swashbuckle CLI tool.

For complete details, see the [Swashbuckle documentation](https://github.com/domaindrivendev/Swashbuckle.AspNetCore/blob/2c19d86a944d1f4e00bf26112d812b12b8c5663e/docs/configure-and-customize-cli.md#retrieve-swagger-directly-from-a-startup-assembly).

### Installation

Install the required packages and CLI tool:

```shell
dotnet tool install -g Swashbuckle.AspNetCore.Cli
```

### Enable Build-Time Generation

Add the following target to your `.csproj` file to automatically generate the OpenAPI document during build:

```xml
<Target Name="GenerateOpenApiDocument" AfterTargets="Build">
  <Exec Command="dotnet swagger tofile --output ./openapi.json $(OutputPath)$(AssemblyName).dll v1" />
</Target>
```

After adding this target, the OpenAPI document will be generated automatically when you build your project.

## Publishing to Scalar Registry

Once you have generated your OpenAPI document at build time, you can easily publish it to the Scalar Registry as part of your CI/CD pipeline.

### Using GitHub Actions

Create a workflow file `.github/workflows/publish-openapi.yml`:

```yaml
name: Publish OpenAPI to Scalar Registry

on:
  push:
    branches: [main]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.x'
          
      - name: Build and Generate OpenAPI
        run: |
          dotnet build
          
      - name: Publish to Scalar Registry
        run: |
          npx @scalar/cli publish ./openapi.json \
            --token ${{ secrets.SCALAR_TOKEN }} \
            --name "My API" \
            --description "Generated from build"
```

### Using GitLab CI

Add this to your `.gitlab-ci.yml`:

```yaml
publish-openapi:
  stage: deploy
  image: mcr.microsoft.com/dotnet/sdk:8.0
  script:
    - dotnet build
    - npm install -g @scalar/cli
    - scalar publish ./openapi.json --token $SCALAR_TOKEN --name "My API"
  only:
    - main
```

For more details on publishing to the registry, see our [Scalar Registry Guide](/guides/registry/upload).